<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>たわみ計算機</title>
  <style>
    body { font-family: sans-serif; background:#f5f5f5; padding:20px; }
    .box { background:#fff; padding:20px; max-width:420px; border-radius:8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width:100%; margin-bottom:10px; padding:8px; font-size:16px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    button { background: #007bff; color: white; border: none; cursor: pointer; margin-top: 10px; }
    button:hover { background: #0056b3; }
    .result { font-size:18px; font-weight:bold; color: #d9534f; margin-top: 15px; }
  </style>
</head>
<body>

<div class="box">
  <h2>はりのたわみ計算機</h2>
  <form id="calcForm">
    <label>断面形状</label>
    <select id="shape">
      <option value="block">角材 (b*a^3/12)</option>
      <option value="round">丸棒 (πd^4/64)</option>
      <option value="l">L形鋼 (簡易計算)</option>
      <option value="h">H/I形鋼 (簡易計算)</option>
    </select>

    <label>寸法 a (高さ/直径) [mm]</label>
    <input type="number" id="inpA" step="any">

    <label>寸法 b (幅) [mm]</label>
    <input type="number" id="inpB" step="any">

    <label>板厚 t [mm] (鋼材のみ)</label>
    <input type="number" id="inpT" step="any">

    <label>スパン L [mm]</label>
    <input type="number" id="inpL" step="any">

    <label>中央荷重 P [N]</label>
    <input type="number" id="inpP" step="any">

    <label>縦弾性係数 E [GPa]</label>
    <select id="inpE">
      <option value="205">鉄 (205 GPa)</option>
      <option value="70">アルミ (70 GPa)</option>
      <option value="3">MCナイロン (3 GPa)</option>
    </select>

    <button type="button" onclick="calc()">計算実行</button>
    <div class="result" id="resArea"></div>
  </form>
</div>

<script>
function calc() {
  // 要素を確実に取得
  const shape = document.getElementById("shape").value;
  const a = parseFloat(document.getElementById("inpA").value);
  const b = parseFloat(document.getElementById("inpB").value) || 0;
  const t = parseFloat(document.getElementById("inpT").value) || 0;
  const L = parseFloat(document.getElementById("inpL").value);
  const P = parseFloat(document.getElementById("inpP").value);
  const E_gpa = parseFloat(document.getElementById("inpE").value);
  const resultDiv = document.getElementById("resArea");

  // 基本的なバリデーション
  if (!a || !L || !P) {
    resultDiv.textContent = "寸法a、L、Pを正しく入力してください";
    return;
  }

  const E = E_gpa * 1000; // N/mm2に変換
  let I = 0;

  // 断面二次モーメントの計算
  if (shape === "block") {
    I = (b * Math.pow(a, 3)) / 12;
  } else if (shape === "round") {
    I = (Math.PI * Math.pow(a, 4)) / 64;
  } else if (shape === "l") {
    // 簡易：重心移動を考慮しない中空近似（本来はもう少し複雑です）
    I = (b * Math.pow(a, 3) - (b - t) * Math.pow(a - t, 3)) / 12;
  } else if (shape === "i" || shape === "h") {
    I = (b * Math.pow(a, 3) - (b - t) * Math.pow(a - 2 * t, 3)) / 12;
  }

  if (I <= 0) {
    resultDiv.textContent = "形状データが不正です";
    return;
  }

  // たわみ公式: δ = (P * L^3) / (48 * E * I)
  const delta = (P * Math.pow(L, 3)) / (48 * E * I);
  resultDiv.textContent = "最大たわみ：約 " + delta.toFixed(3) + " mm";
}
</script>

</body>
</html>
